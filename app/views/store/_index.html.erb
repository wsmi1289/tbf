<% cache ['store', Product.latest] do %>
  <% @products.each do |product| %>
    <% cache ['entry', product] do %>
      <div id="entry" class="card flex-item" style="width: 18rem;">
        <%= image_tag(product.image_url(:thumb), class: "card-img-top") %>
        <div class="card-body">
          <h4 class="card-title"><%= product.title %></h4>
          <div class="card-text">
            <p><%= product.description %></p>
            <p><%= product.category %></p>
            <span class="price"><%= number_to_currency(product.price) %></span>
            <%= form_tag(line_items_path(product_id: product), remote: true) do %>
              <%= label_tag 'quantity' %>
              <%= select_tag 'quantity', options_for_select(1..15) %>
              <%= submit_tag 'Add to Cart', class: 'btn btn-light'%>
            <% end -%>
          </div>
        </div>
        <div class="card-footer text-center">
          <% if current_user.try(:admin) %>
            <%= link_to 'Delete', product, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-light'  %>
            <%= link_to 'Edit', edit_product_path(product), class: 'btn btn-light' %>
            <%= label_tag :in_stock %>
            <%= check_box_tag('in_stock', "true", product.in_stock, 
                            data: {
                                    id: product.id,
                                    remote: true,
                                    url: url_for(
                                      controller: 'products',
                                      action: 'toggle',
                                      id: product.id),
                                    method: "POST"
                                  }) %>
          <% end -%>
        </div>
      </div>
    <% end -%>
  <% end %>
<% end -%>